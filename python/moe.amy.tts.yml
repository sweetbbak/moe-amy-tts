app-id: moe.amy.tts
runtime: org.freedesktop.Platform
runtime-version: '22.08'
sdk: org.freedesktop.Sdk
command: gui.py
modules:

  - pypix-dependencies.json

  - name: pip-installs
    buildsystem: simple
    sources:
      - type: file
        path: piper_tts-1.2.0-py3-none-any.whl
        url: https://files.pythonhosted.org/packages/24/aa/215bced0725cf5b5afe939f86b177c8ddb0d38292a94e85c55b3fcf6d46d/piper_tts-1.2.0-py3-none-any.whl
        sha256: f3410aea0f8051d8a118050a5b954faeb36f6ac0da6d10fc2f8a043a8eaf27b5

      - type: file
        path: piper_phonemize-1.1.0-cp311-cp311-manylinux_2_28_x86_64.whl
        url: https://files.pythonhosted.org/packages/b8/b7/a8fc2584d509ca36d5713693d675a88f80e4c3725e16a8c7ff1451f0ba99/piper_phonemize-1.1.0-cp311-cp311-manylinux_2_28_x86_64.whl
        sha256: c1062e00c94835e9115df7ce1d7b3b5c40c6d845cd70b2c121954faf5b8d23c7

    build-options:
      - build-args:
        - --share=network
    build-commands:
      # - pip3.10 install --no-index --prefix=${FLATPAK_DEST} --no-build-isolation -r piper-tts
      - pip3.10 install --no-index --prefix=${FLATPAK_DEST} --no-build-isolation -r piper_tts-1.2.0-py3-none-any.whl

  - name: desktop
    sources:
    - type: file
      path: moe.amy.tts.desktop
    - type: file
      path: moe.amy.tts.desktop
    buildsystem: simple
    build-commands:
      - install -Dm755 moe.amy.tts.desktop /app/share/applications/moe.amy.tts.desktop

  - name: icon
    sources:
    - type: file
      path: amy.png
    buildsystem: simple
    build-commands:
      - install -Dm644 amy.png /app/share/icons/hicolor/128x128/app/moe.amy.tts.png

  # - name: run.sh
  #   sources:
  #   - type: file
  #     path: run.sh
  #   buildsystem: simple
  #   build-commands:
  #     - install -Dm755 run.sh /app/bin/run.sh

  - name: ivona
    sources:
    - type: file
      path: amy.onnx
      url: https://raw.githubusercontent.com/sweetbbak/Neural-Amy-TTS/main/models/ivona_tts/amy.onnx
      sha256: 0c1d4d74dbba433deb99816334fa77824bb770c8544cbc0724e45583e90e6e3b
    buildsystem: simple
    build-commands:
      - mkdir /app/ivona
      - mv amy.onnx /app/ivona

  - name: ivona2
    sources:
    - type: file
      url: https://raw.githubusercontent.com/sweetbbak/Neural-Amy-TTS/main/models/ivona_tts/amy.onnx.json
      sha256: f83744ff6aa6138ebade1357b65b3f8456bc00b9edb913ab78674eb323ca32d0
      path: amy.onnx.json
    buildsystem: simple
    build-commands:
      - mv amy.onnx.json /app/ivona

finish-args:
  - --share=ipc
  - --socket=x11
  - --socket=pulseaudio
  - --socket=wayland
  - --filesystem=home
